{
  "entities": {
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task in the TaskFlow application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Task entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Task). The user who created or is assigned to the task."
        },
        "title": {
          "type": "string",
          "description": "The title of the task."
        },
        "description": {
          "type": "string",
          "description": "A more detailed description of the task."
        },
        "isComplete": {
          "type": "boolean",
          "description": "Indicates whether the task is complete or not."
        },
        "subTaskIds": {
          "type": "array",
          "description": "References to SubTasks. (Relationship: Task 1:N SubTask).",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "description",
        "isComplete"
      ]
    },
    "SubTask": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SubTask",
      "type": "object",
      "description": "Represents a sub-task within a parent task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SubTask entity."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N SubTask). The parent task this subtask belongs to."
        },
        "description": {
          "type": "string",
          "description": "Description of the subtask."
        },
        "isComplete": {
          "type": "boolean",
          "description": "Indicates whether the subtask is complete."
        }
      },
      "required": [
        "id",
        "taskId",
        "description",
        "isComplete"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the TaskFlow application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity.  This will likely be the Firebase UID."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        }
      },
      "required": [
        "id",
        "email",
        "displayName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Document ID is the Firebase UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores tasks created by each user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase UID of the user who created the task."
            },
            {
              "name": "taskId",
              "description": "The unique identifier for the task."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tasks/{taskId}/subtasks/{subtaskId}",
        "definition": {
          "entityName": "SubTask",
          "schema": {
            "$ref": "#/backend/entities/SubTask"
          },
          "description": "Stores subtasks associated with a specific task for a given user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase UID of the user who owns the task."
            },
            {
              "name": "taskId",
              "description": "The unique identifier for the parent task."
            },
            {
              "name": "subtaskId",
              "description": "The unique identifier for the subtask."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure secure and scalable data management for the TaskFlow application. It leverages path-based ownership and denormalization to achieve authorization independence, simplifying security rules and enabling atomic operations. Tasks and SubTasks are organized under user-specific collections to enforce clear ownership. This approach ensures that listing operations are secure, as each user can only access tasks and subtasks under their control. User data is stored in a dedicated collection with the UID as the document ID for easy authentication integration.\n\nThe `/users/{userId}/tasks/{taskId}` structure is used to store task data, which creates a direct relationship between user and task. The `/users/{userId}/tasks/{taskId}/subtasks/{subtaskId}` structure creates a 1:N relationship for tasks to subtasks, allowing for hierarchical data storage. The `users` collection stores user profiles.\n\nAuthorization Independence:\nThe `tasks` and `subtasks` collections are structured under `/users/{userId}` path, which implicitly enforces that each task and subtask belongs to the user identified by `{userId}`. Security rules can easily use `request.auth.uid` to validate that the user accessing or modifying the data matches the `{userId}` in the path, without needing to read any data from the database.\n\nQAPs (Rules are not Filters):\nThis structure allows for secure `list` operations because the security rules can easily limit access to only the tasks and subtasks where `request.auth.uid == userId` in the path. This structure prevents unauthorized listing of tasks and subtasks belonging to other users.\n"
  }
}